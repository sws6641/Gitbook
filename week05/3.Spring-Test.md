# 3. Spring Test

### 학습 키워드

- 통합 테스트(Integration Test)
- `@Autowired`
- `@SpyBean`
- MockMvc
- MockBean
- `@WebMvcTest`

***

### 통합 테스트(Integration Test)

* 정의

    * 서로 다른 시스템들의 상호작용이 잘 이루어 지는지 테스트

    * 여러 애플리케이션 부분의 상호 작용을 통해 결함을 발견

* 특징

    * 유닛 테스트는 다른 컴포넌트들과 독립적인 반면 통합 테스트는 그렇지 않다.

    * 유닛 테스트에서 데이터베이스에 접근하는 코드는 실제 데이터 베이스와 통신하는 것은 아니지만, 통합 테스트는 실제 통신해야 한다.

    * 통합 테스트는 유닛 테스트만으로 충분하다고 느끼지 못할 때 사용된다.

    * 통합 테스트는 대게 유닛 테스트를 작성하는 것보다 복잡하고 오랜 시간이 걸린다.

### @Autowired

* 정의

    * 스프링 컨테이너에 등록한 빈에게 의존관계주입이 필요할 때, DI(의존성 주입)을 도와주는 어노테이션이다.

* 특징

    * 3가지 방법으로 실현이 가능한데, 생성자, 수정자(setter), 필드를 사용할 수 있다.

    * 생성자 주입 방식을 권장

### @SpyBean

* 스프링 컨테이너에 Bean으로 등록된 객체에 대해 Spy를 생성해준다.

* given에서 stub한 메서드 외에는 그 객체의 실제 메서드를 사용할 수 있다.

    * stub - 기대 행위를 작성하는 것

* given에서 선언한 코드 외에는 전부 실제 객체의 것을 사용한다.

* 특정 객체의 일부 메서드만 stub하고, 나머지는 실제 메서드를 사용하고 싶을 때 사용한다.

### MockMvc

* 정의

    * 웹 어플리케이션을 애플리케이션 서버에 배포하지 않고 테스트용 MVC환경을 만들어 요청 및 전송, 응답기능을 제공해주는 유틸리티 클래스이다.

    * 컨트롤러 테스트를 하고싶을 때 실제 서버에 구현한 애플리케이션을 올리지 않고(실제 서블릿 컨테이너를 사용하지 않고) 테스트용으로 시뮬레이션하여 MVC가 되도록 도와주는 클래스

* 특징

    * 서버를 구동시키지 않아도 테스트 가능

    * api 테스트를 하는 것이기 때문에 controller에 구성된 코드들을 테스트

    * client가 api를 요청하는 것처럼 api 경로를 입력하여 테스트하는 방식

### MockBean

* 정의

    * 스프링 부트 테스트에서 제공하는 어노테이션

    * 더 빠르게 테스트를 실행하기 위해 전부 가짜로 채워넣을 수도 있다.

    * 기존에 사용되던 Bean의 껍데기만 가져오고 내부의 구현 부분은 모두 사용자에게 위임한 형태

* 특징

    * Spring Boot Container가 테스트 시에 필요하고 Bean이 Container에 존재한다면 @MockBean을 사용하고 아닌 경우에는 @Mock을 사용합니다.

    * @WebMvcTest를 이용한 테스트에서 사용할 수 있습니다.

    * mock 객체를 스프링 컨텍스트에 등록하기 때문에 @SpringBootTest를 통해서 Autowired에 의존성이 주입한다.

### @WebMvcTest

* 정의

    * Controller를 테스트하기 위한 어노테이션

* 특징

    * MockBean, MockMVC를 자동 구성하여 테스트 가능하도록 한다.

    * Spring Security의 테스트도 지원 한다.

* 장점

    * WebApplication 관련된 Bean들만 등록하기 때문에 통합 테스트보다 빠르다.

    * 통합 테스트를 진행하기 어려운 테스트를 진행 가능하다.

* 단점

    * 요청부터 응답까지 모든 테스트를 Mock 기반으로 테스트하기 때문에 실제 환경에서는 제대로 동작하지 않을 수 있다.


