# 3. Collection Pattern

### 학습 키워드

리소스를 중심으로 API 디자인 구성&#x20;

HTTP 메서드 측면에서 API 작업 정의&#x20;

HTTP 의미 체계 준수&#x20;

데이터 필터링 및 페이지 매기기&#x20;

대용량 이진 리소스에 대한 부분 응답 지원&#x20;

HATEOAS를 사용하여 관련 리소스 탐색&#x20;

RESTful 웹 API 버전 관리&#x20;

Open API Initiative



***



### 리소스를 중심으로 API 디자인 구성&#x20;

* 리소스 URI는 동사(리소스에 대한 작업)가 아닌 명사(리소스)를 기반으로 해야 한다.

```
https://adventure-works.com/orders // Good

https://adventure-works.com/create-order // Avoid
```

* REST의 목적은 엔터티 및 해당 엔터티에서 애플리케이션이 수행할 수 있는 작업을 모델링하는 것입니다.
* 엔터티는 종종 컬렉션(주문, 고객)으로 그룹화된.&#x20;
* 컬렉션은 컬렉션 내 항목과는 별도의 리소스이며 고유한 URI가 있어야 한다.
* 리소스 URI를 _<mark style="color:green;">컬렉션/항목/컬렉션</mark>_보다 더 복잡하게 요구하지 않는 것이 좋다.

```
/customers/1/orders/99/products (x)
/customers/1/orders + /orders/99/products (O)
```



### HTTP 메서드 측면에서 API 작업 정의&#x20;

* HTTP 프로토콜은 요청에 의미 체계의미를 할당하는 다양한 메서드를 정의합니다. 대부분의 RESTful 웹 API에서 사용하는 일반적인 HTTP 메서드는 다음과 같습니다.
  * GET - 검색, 조회
  * POST - 새로운 리소스 등록
  * PUT - 리소스를 만들거나 대체
  * PATCH - 부분 업데이트
  * DELETE - 리소스 제거

<figure><img src="../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>



### HTTP 의미 체계 준수&#x20;

#### 미디어유형

* 요청 또는 응답의 Content-Type 헤더는 표현 형식을 지정한다.
* 일반적으로는 JSON, XML을 사용
* 지원하지 않는 미디어 유형을 받으면 상태코드 415를 반환
* 어떤 미디어 유형인지 알 수 없으면 상태코드 406

#### GET 메서드 <a href="#get-methods" id="get-methods"></a>

* 성공적인 GET 메서드는 일반적으로 HTTP 상태 코드 200(정상)를 반환한다.&#x20;
* 리소스를 찾을 수 없는 경우 메서드가 404(찾을 수 없음)를 반환해야 한다.
* HTTP 응답에 포함된 응답 본문이 없는 경우 HTTP 상태 코드 204(콘텐츠 없음)를 반환해야 한다.(일치 항목이 없는 검색 작업 시)

#### POST 메서드 <a href="#post-methods" id="post-methods"></a>

* 새 리소스를 만드는 경우 HTTP 상태 코드 201(만들어짐)을 반환한다.
* 일부 처리를 수행하지만 새 리소스를 만들지 않는 경우 메서드는 HTTP 상태 코드 200을 반환한다.
* 반환할 결과가 없으면 메서드가 응답 본문 없이 HTTP 상태 코드 204(내용 없음)를 반환할 수 있다.
* 클라이언트가 잘못된 데이터를 요청에 배치하면 서버에서 HTTP 상태 코드 400(잘못된 요청)을 반환해야 한다.

#### PUT 메서드 <a href="#put-methods" id="put-methods"></a>

* 새 리소스를 만드는 경우 HTTP 상태 코드 201(만들어짐)을 반환한다.
* 기존 리소스를 업데이트할 경우 200(정상) 또는 204(내용 없음)를 반환한다.
* PUT 요청은 컬렉션의 URI를 지정해야 하며, 요청 본문에 수정할 리소스의 세부 정보를 지정해야 한다.&#x20;
* 이 접근 방식은 데이터 전송량을 줄이고 성능을 향상시킬 수 있다.

#### PATCH 메서드 <a href="#patch-methods" id="patch-methods"></a>

* Web API에 대한 가장 일반적인 데이터 형식은 JSON일 것이다.
* JSON 병합 패치에서는 변경, 추가할 필드만 전송하면 되며, null로 필드를 삭제할 수 있음
* 때문에 원래 null값을 가질 수 있으면 JSON 병합 패치는 사용이 어려움
* (삭제 요청인지, 수정하려는 필드가 아니어서 데이터가 안들어온건지 구분이 안되기 때문)
* 지원하지 않는 패치 문서 형식은 415
* 패치 문서 형식이 잘못되면 400
* 패치 문서가 유효하지만 현재 상태에서 변경이 불가한 경우 409

#### DELETE 메서드 <a href="#delete-methods" id="delete-methods"></a>

* HTTP 상태 코드 204(콘텐츠 없음)로 응답해야 한다.
* 리소스가 없는 경우 웹 서버는 HTTP 404(찾을 수 없음)를 반환할 수 있다.

#### 비동기 작업 <a href="#asynchronous-operations" id="asynchronous-operations"></a>

* POST, PUT, PATCH 또는 DELETE 작업을 완료하는 데 시간이 걸리는 처리가 필요할 수 있다.
* 이 경우 비동기 작업을 수행하는 방안을 고려해 보아야 한다.
* 요청 처리가 수락되었지만 아직 완료되지 않았음을 나타내는 HTTP 상태 코드 202(수락됨)를 반환한다.
* 202로 임시 응답을 했다면 처리 상태를 확인할 수 있는 엔드포인트를 제시해줘야 한다.
* 엔드포인트로 GET 요청을 보내면 현재 상태와 예상 완료시간, 작업 취소 등을 보내주면 된다.
* 작업 완료 후 엔드포인트로 요청이 오면 303을 반환해 주고 완료된 리소스를 조회할 URI를 Location 헤더에 추가한다.

#### 메시지 본문의 빈 집합 <a href="#empty-sets-in-message-bodies" id="empty-sets-in-message-bodies"></a>

* 성공적인 응답의 본문이 비어 있을 때마다 상태 코드는 204(콘텐츠 없음)여야 한다.
* 항목이 없는 필터링된 요청에 대한 응답과 같은 빈 집합의 경우 상태 코드는 여전히 200(OK)이 아닌 204(콘텐츠 없음)여야 한다.



### 데이터 필터링 및 페이지 매기기&#x20;

* 단일 URI를 통해 리소스 컬렉션을 표시하면 정보의 하위 집합만 필요할 때에도 애플리케이션이 대량의 데이터를 가져올 수 있다.

```
/orders URI                 (x)
/orders?minCost=n           (o)
/orders?limit=25&offset=50  (o)
```



### 대용량 이진 리소스에 대한 부분 응답 지원&#x20;

* 리소스에 파일 또는 이미지 같은 대용량 이진 필드가 포함될 수 있다.
* Web API가 큰 리소스의 GET 요청에 대해 Accept-Ranges 헤더를 지원해야 한다.
* 이 헤더는 GET 작업이 부분 요청을 지원한다는 것을 나타낸낸다.



### HATEOAS를 사용하여 관련 리소스 탐색&#x20;

* 각 HTTP GET 요청은 응답에 포함된 하이퍼링크를 통해 요청된 개체와 직접 관련된 리소스를 찾는 데 필요한 정보를 반환해야 하며
* 이러한 각 리소스에 대해 사용할 수 있는 작업을 설명하는 정보도 제공되어야 합니다.

