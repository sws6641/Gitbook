# 1. CQRS

## 학습 키워드

- CQS
- CQRS
- SSOT(Single Source Of Truth)
- Materialized View
- OLTP(Online Transaction Processing)
- OLAP(Online Analytical Processing)
- Event Sourcing

***

### CQS (CommandQuerySeparation)

- 쿼리와 커맨드를 분리하는 것에 집중되어있다

- 메서드 또는 기능을 명령 또는 쿼리로 분류해야 하지만 둘 다로 분류해서는 안 된다는 소프트웨어 설계 원칙

- Command - C(Create)U(Update)D(Delete) 상태를 변경하는 것

- Query - R(Read) 상태가 변하지 않는 것

### CQRS

- 읽기와 쓰기를 다른 모델로 분리하는 디자인 패턴

- DB는 하나지만 두개의 모델로 나누어서 관리

- Command Model (Write Model)

  - DDD 등을 통해 구현하는 application layer, remote facade 등을 통해 기능 - 작동

  - 상태를 변화시킬 수 있음

  - 가급적 하나의 서비스에서 한 가지 방식으로만 구현

  - Single Source of Truth (SSOT - 단일 진실 공급원)

- Query Model (Read Model)

  - 작업이 끝나고난 뒤 현재 상태만 조회하면 됨

  - DTO Fetcher 등을 통해 클라이언트와 DTO를 주고받으며 데이터를 조회할 수 있게 함

  - 상황에 맞게 필요한 기술 적용 (Redis 등)

- Write Model과 Read Model의 내용은 동기화가 되어 있어야 함

- 상태가 변화되고 나면 그 결과를 Read Model에서도 올바르게 담고 있어야 함

- CQS는 개별 메서드 내에서 명령과 쿼리를 분리하는 데 중점을 두는 반면, CQRS는 이러한 분리를 시스템 수준에서 읽기 및 쓰기 작업을 처리하는 여러 구성 요소로 확장한다.

### SSOT(Single Source Of Truth)

- 데이터를 한 곳에만 저장하는 데이터 관리 개념

- 시스템이나 조직 내에서 정보 또는 데이터의 신뢰할 수 있는 단일 소스가 있어야 함을 제안한다.

- 진실 공급원의 데이터 요소를 갱신하면 수정 사항 반영을 빠뜨릴 데이터의 사본이 존재할 가능성 없이 시스템 전체에 전파되게 된다.

### Materialized View

- 조회 성능을 향상시키기 위해 미리 계산된 뷰

- 실시간으로 데이터를 계산하는 일반 뷰와 달리 Materialized View는 데이터를 쿼리하고 새로 고쳐질 시점에 결과를 저장한다.

- 일반 View와는 다르게 물리적으로 저장되고 주기적으로 동기화가 이루어진다.

- RDBMS의 성능을 향상시킨다

- 복잡한 인프라 없이 CQRS를 구현하기에 용이하다

### OLTP(Online Transaction Processing)

- 트랜잭션 지향 애플리케이션을 관리하는 시스템

- 실시간 트랜잭션 처리를 위해 설계됨

- 삽입, 업데이트, 삭제와 같은 짧은 온라인 트랜잭션이 많다.

- 매우 빠른 쿼리 처리, 다중 액세스 환경에서의 데이터 무결성 유지, 초당 트랜잭션 수로 측정되는 효율성에 중점을 두고 있다.

### OLAP(Online Analytical Processing)

- 비즈니스 의사 결정을 위한 데이터 분석을 제공하는 소프트웨어 도구

- 여러 데이터베이스 시스템의 데이터베이스 정보를 한 번에 분석할 수 있도록 설계되었다.

- 특정 기간 동안의 판매량 합산과 같이 복잡하고 집계가 필요한 분석 쿼리에 대한 빠른 답변을 제공하는 것이 목적이다.

#### 차이점

- OLTP 시스템은 모든 종류의 쿼리(읽기, 삽입, 업데이트, 삭제)를 처리하는 반면

- OLAP은 읽기 작업에 최적화되어 있다.

- OLTP는 운영 데이터 처리에 더 중점을 두며 비즈니스의 일상적인 트랜잭션에 초점을 맞추는 반면

- OLAP는 데이터 분석에 더 중점을 두며 비즈니스가 정보에 입각한 의사 결정을 내릴 수 있도록 지원하는 데 중점을 둔다.

### Event Sourcing

- 애플리케이션의 상태를 이벤트 시퀀스로 유지한다는 아이디어를 중심으로 하는 소프트웨어 아키텍처 패턴

- 데이터의 현재 상태만 저장하는 것이 아니라, 데이터의 변경 이벤트 과정을 모두 저장한다.

- 이벤트를 재생하면 언제든지 데이터의 현재 상태를 얻을 수 있다.

- 단순 CRUD 애플리케이션에서는 사용하기 부적합하고, 데이터 변경 이력을 추적해야 하는 경우에 사용하기 좋다.

ex) 예를 들면 다음과 같은 이벤트가 쌓였다면…

1. 장바구니에 상품 #1을 3개 담았다.
2. 장바구니에 상품 #2를 1개 담았다.
3. 장바구니에서 상품 #1을 1개 뺐다.

현재 상태는 다음과 같다: 장바구니에 상품 #1이 2개, 상품 #2가 1개 담겨 있다.
