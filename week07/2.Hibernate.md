# 2. Hibernate

## 학습 키워드

- Hibernate
- 데이터 모델 / 객체 모델
- entityManager
- 트랜잭션
- JPQL

***

### Hibernate

- 정의

  - JPA를 사용하기 위해서 JPA를 구현한 ORM 프레임워크 중 하나

  - 자바 언어를 위한 ORM 프레임워크

  - JPA의 구현체로 JPA 인터페이스를 구현하며, 내부적으로 JDBC API를 사용한다.

  - ORM 프레임워크 중 가장 많이 사용되며, JPA 인터페이스의 실제 구현부를 담당한다.

- 장점

  - 생산성

    - SQL을 직접 사용하지 않고, 메서드 호출만으로 쿼리가 수행된다.

    - 즉, SQL 반복 작업을 하지 않음으로 생산성이 높아진다.

  - 유지보수

    - 테이블 컬럼이 변경되었을 때, 테이블과 관련된 DAO의 파라미터, 결과, SQL 등을 대신 수행한다.

    - 이로 인해 유지보수 측면에서 높아진다.

  - 특정 벤더(MySQL, Oracle 등)에 종속적이지 않음

    - JPA는 추상화된 데이터 접근 계층을 제공하기 때문에 특정 벤더에 종속적이지 않는다.

    - 설정 파일에서 JPA에게 어떤 DB를 사용하고 있는지를 알려주기만 하면 얼마든지 DB를 바꿀 수 있다.

  - 패러다임 불일치 해결

    - 상속, 연관 관계, 객체 그래프 탐색, 비교 등 객체와 관계형 데이터베이스와의 패러다임 불일치를 해결할 수 있다.

- 단점

  - 성능

    - 메서드 호출만으로 쿼리를 수행하는 것은 직접 SQL을 작성하는 것보다는 성능상 좋지 않다.

  - 세밀함

    - 메서드 호출만으로 DB 데이터를 조작하기에는 한계가 있다. 이를 보완하기 위해 JPQL을 지원한다.

    - NativeQuery를 지원하여 SQL 자체 쿼리도 작성할 수 있다.

### 데이터 모델 / 객체 모델

#### 데이터 모델

- DB에 Table 단위로 저장되는 모델

  - Table PK, FK 등 DB에서 필요한 값들이 들어감

  - 관계가 Table 단위로 설정되고, FK로 관계가 설정됨

#### 객체 모델

- 비즈니스 로직에서 사용하기 위한 객체 모델

  - 비즈니스 로직에 필요한 값들이 들어감

  - 의존, 상속 등 프로그래밍 언어로 관계가 설정됨

### entityManager

- JPA를 사용하기 위해서는 Database 구조와 맵핑된 JPA Entity 들을 먼저 생성하게 된다.

- 그리고 모든 JPA의 동작은 이 Entity들을 기준으로 돌아가게 된다.

- 이 때 Entity들을 관리하는 역할을 하는게 바로 EntityManager이다.

- 엔티티를 저장하고, 수정하고, 삭제하고 조회하는 등 엔티티와 관련된 모든 일을 처리한다.

- 영속성 컨텍스트를 통해 데이터의 상태 변화를 감지하고 필요한 쿼리를 자동으로 수행한다.

### 영속성 컨텍스트 (Persistence Context)

- 엔티티를 영구 저장하는 환경

- 애플리케이션과 데이터베이스 사이에서 엔티티 데이터를 저장하고 있는 공간이다.

- 논리적인 개념으로 JPA 에서 데이터를 저장하면 데이터베이스에 바로 저장되는 것이 아니라 영속성 컨텍스트에 먼저 저장된다.

- 엔티티 매니저로 엔티티를 저장하거나 조회하면 엔티티 매니저는 영속성 컨텍스트에 엔티티를 보관하고 관리한다.

### 트랜잭션

- 데이터베이스에서 수행되는 작업 단위를 의미한다.

- 여러 개의 데이터베이스 연산(INSERT, UPDATE, DELETE 등)을 하나의 논리적인 작업 단위로 묶어서 실행하는 것이다.

- 모든 연산이 성공적으로 수행되면 트랜잭션을 커밋(commit)하여 데이터베이스에 반영하고 하나라도 실패하면 롤백(rollback)하여 이전 상태로 되돌린다.

- 데이터베이스 서버에 여러 개의 클라이언트가 동시에 액세스 하거나 응용프로그램이 갱신을 처리하는 과정에서 중단될 수 있는 경우 등 데이터 부정합을 방지하고자 할 때, 쉽게 말하면 여러 작업을 묶을 때 사용한다.

#### 트랜잭션의 성질 (ACID)

  - Atomicity (원자성)

    - 하나의 트랜잭션이 더 이상 작게 쪼갤 수 없는 최소한의 업무 단위이다.

    - 트랜잭션의 연산은 데이터베이스에 모두 반영되든지 아니면 전혀 반영되지 않아야 한다.

  - Consistency (일관성)

    - 트랜잭션이 그 실행을 성공적으로 완료하면 언제나 일관성 있는 데이터베이스 상태로 변환한다.

    - 시스템이 가지고 있는 고정요소는 트랜잭션 수행 전과 트랜잭션 수행 완료 후의 상태가 같아야 한다.

  - Isolation (독립성)

    - 둘 이상의 트랜잭션이 동시에 병행 실행되는 경우 어느 하나의 트랜잭션 실행 중에 다른 트랜잭션의 연산이 끼어들 수 없다.

    - 수행중인 트랜잭션은 완전히 완료될 떄까지 다른 트랜잭션에서 수행 결과를 참조할 수 없다.

  - Durability (영속성)

    - 성공적으로 완료된 트랜잭션의 결과는 시스템이 고장나더라도 영구적으로 반영되어야 한다.

### JPQL(Java Persistence Query Language)

- JPA에서 제공하는 쿼리방법 중 하나이다.

- JPA는 SQL을 추상화한 JPQL이라는 객체 지향 쿼리 언어를 제공한다.

- 따라서 테이블을 대상으로 쿼리 하는 것이 아닌 엔티티 객체를 대상으로 쿼리한다.

- JPQL은 결국 SQL로 번역되어 실행된다.

- JPQL은 SQL을 추상화해서 특정 데이터베이스 SQL에 의존하지 않는다.
